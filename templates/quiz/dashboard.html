{% extends 'base.html' %}

{% block content %}
<style>
    .dashboard-header {
        margin-bottom: 3rem;
    }

    .page-card-custom {
        padding: 2rem;
        border-left: 6px solid var(--primary);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .page-card-instructor {
        padding: 2rem;
        border-left: 6px solid var(--secondary);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        background: #f8fafc;
    }

    .quiz-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .quiz-item {
        display: flex;
        justify-content: space-between;
        align-items: start;
        padding: 1.5rem;
        background: white;
        border-radius: 12px;
        border: 1px solid #eee;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
    }

    .perf-summary {
        cursor: pointer;
        list-style: none;
        padding: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #fff;
        border-radius: 12px;
    }

    .perf-details {
        padding: 0 1.5rem 1.5rem 1.5rem;
        animation: fadeIn 0.2s ease-in-out;
    }

    .attempt-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.6rem 1rem;
        background: #f9fafb;
        border-radius: 8px;
        margin-bottom: 0.75rem;
    }

    details[open] .perf-summary {
        border-radius: 12px 12px 0 0;
        background: #f8fafc;
        border-bottom: 1px solid #eee;
    }

    details[open] .chevron {
        transform: rotate(90deg) !important;
    }

    summary::-webkit-details-marker {
        display: none;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-5px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

<div class="dashboard-header">
    <h1>Learning Dashboard</h1>
    <p class="text-muted" style="font-size:1.1rem;">Track your progress and practice new concepts.</p>
</div>

<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem;margin-bottom:3rem;">
    <div class="page-card page-card-custom">
        <div>
            <h3 style="margin-bottom:0.5rem;color:var(--primary);">Custom Test Generator</h3>
            <p class="text-secondary" style="margin-bottom:1.5rem;">Generate sessions based on topics and difficulty.
            </p>
        </div>
        <a href="{% url 'create_test' %}" class="btn btn-primary" style="align-self:flex-start;">ðŸš€ Create New Test</a>
    </div>
    {% if user.is_staff or user.is_superuser %}
    <div class="page-card page-card-instructor">
        <div>
            <h3 style="margin-bottom:0.5rem;color:var(--secondary);">Instructor Tools</h3>
            <p class="text-secondary" style="margin-bottom:1.5rem;">Manage question bank and review submissions.</p>
        </div>
        <a href="{% url 'question_bank' %}" class="btn btn-secondary" style="align-self:flex-start;">ðŸ“‚ Question
            Bank</a>
    </div>
    {% endif %}
</div>

<div style="margin-bottom:3rem;">
    <h2 style="margin-bottom:1.5rem;">Ready to Practice?</h2>
    {% if quizzes %}
    <div class="quiz-grid">
        {% for quiz in quizzes %}
        <div class="quiz-item">
            <div style="flex:1;">
                <h4>{{ quiz.title }}</h4>
                <p class="text-secondary" style="font-size:0.95rem;margin-bottom:0.5rem;">{{ quiz.description }}</p>
                <div style="display:flex;gap:1rem;align-items:center;">
                    <span class="text-muted">{{ quiz.time_limit_minutes }} mins</span>
                    <span class="text-muted">{{ quiz.questions.count }} Questions</span>
                </div>
            </div>
            <div style="display:flex;gap:10px;margin-left:1.5rem;flex-direction:column;">
                <a href="{% url 'take_quiz' quiz.id %}" class="btn btn-secondary btn-sm">Classic</a>
                <a href="{% url 'take_quiz_single' quiz.id %}" class="btn btn-primary btn-sm">JEE Mode</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="page-card" style="text-align:center;padding:3rem;">
        <p class="text-muted">No curated quizzes available.</p>
    </div>
    {% endif %}
</div>

<div>
    <h2 style="margin-bottom:1.5rem;">Your Recent Performance</h2>
    {% if performance_data %}
    <div class="performance-groups">
        {% for group in performance_data %}
        <div class="page-card" style="margin-bottom:1.5rem;padding:0;">
            <details>
                <summary class="perf-summary">
                    <div style="display:flex;align-items:center;gap:10px;">
                        <span class="chevron"
                            style="font-size:1.2rem;transform:rotate(0deg);transition:transform 0.2s;">â–¶</span>
                        <h3 style="margin:0;font-size:1.2rem;">{{ group.quiz.title }}</h3>
                    </div>
                    <span class="badge badge-success">{{ group.attempts|length }} ATTEMPTS</span>
                </summary>
                <div class="perf-details">
                    <div style="display:grid;gap:0.75rem;">
                        {% for attempt in group.attempts %}
                        <div class="attempt-row"
                            style="border-left:3px solid {% if attempt.completed_at %}#10b981{% else %}#f59e0b{% endif %};">
                            <div style="display:flex;gap:2rem;align-items:center;">
                                <span class="text-muted">{{ attempt.started_at|date:"M d, Y H:i" }}</span>
                                {% if attempt.completed_at %}
                                <span style="font-weight:700;">Score: {{ attempt.score|floatformat:1 }}</span>
                                {% else %}
                                <span style="color:#f59e0b;font-weight:700;text-transform:uppercase;">In Progress</span>
                                {% endif %}
                            </div>
                            <div>
                                {% if attempt.completed_at %}
                                <a href="{% url 'result' attempt.id %}" class="btn btn-secondary btn-sm">Review</a>
                                {% else %}
                                <a href="{% url 'take_quiz_single' attempt.quiz.id %}"
                                    class="btn btn-primary btn-sm">Resume</a>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </details>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="page-card" style="text-align:center;padding:2rem;">
        <p class="text-muted">No attempts yet.</p>
    </div>
    {% endif %}
</div>
{% endblock %}